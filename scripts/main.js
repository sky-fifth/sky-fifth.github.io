"use strict";var _KEYCODE_LEFT_ARROW=37;var _KEYCODE_RIGHT_ARROW=39;var _KEYCODE_SPACEBAR=32;var gFonts=[];var gFontsIndex=0;var gTotalPagesCount=5;var gPageIndex=0;var gVoice=null;var gSpeech=null;$(document).ready(function(e){$.getJSON("scripts/fonts.json",function(e){var n=shuffle(e);gFonts=n;loadFirstPage()});$("body").keydown(function(e){switch(e.keyCode){case _KEYCODE_LEFT_ARROW:loadPreviousPage();break;case _KEYCODE_RIGHT_ARROW:loadNextPage();break;case _KEYCODE_SPACEBAR:e.preventDefault();playOrPause();break}})});loadVoices();window.speechSynthesis.onvoiceschanged=function(e){loadVoices()};function loadFirstPage(){gPageIndex=0;loadPage(gPageIndex)}function loadNextPage(){gPageIndex++;if(gPageIndex>=gTotalPagesCount){gPageIndex=0}if(gPageIndex<0){gPageIndex=gTotalPagesCount-1}loadPage(gPageIndex)}function loadPreviousPage(){gPageIndex--;if(gPageIndex>=gTotalPagesCount){gPageIndex=0}if(gPageIndex<0){gPageIndex=gTotalPagesCount-1}loadPage(gPageIndex)}function loadPage(e){var n="page"+e+".txt";if(gSpeech){gSpeech.onend=null}window.speechSynthesis.cancel();gSpeech=null;$.ajax({url:"scripts/"+n,cache:false,dataType:"text",success:function e(a){console.log("Loaded %s",n);$(".page").hide();$(".page").text(a)}});loadRandomFont()}function loadRandomFont(){if(gFonts.length==0){return}if(gFontsIndex==gFonts.length){gFontsIndex=0}var e=gFonts[gFontsIndex];gFontsIndex++;WebFont.load({google:{families:[e+":400:latin,latin-ext"]},fontactive:function e(n,a){console.log("Loaded font %s",n);displayPage(n)},inactive:function e(){displayPage()}})}function displayPage(e){var n=$(".page");if(e){n.css("font-family",e)}n.show();var a=n.text();console.log(a);speak(a)}function speak(e){var n=new SpeechSynthesisUtterance;n.text=e;n.volume=.8;n.rate=1;n.pitch=1;n.voice=gVoice;n.onend=function(e){console.log("Finished speaking.");setTimeout(loadNextPage,550)};n.onerror=function(e){console.log("Error speaking: %s",e.error)};n.onpause=function(e){console.log("Speech paused.")};n.onresume=function(e){console.log("Speech resumed.")};gSpeech=n;window.speechSynthesis.speak(n)}function shuffle(e){var n=e.length;var a;var o;while(0!==n){o=Math.floor(Math.random()*n);n-=1;a=e[n];e[n]=e[o];e[o]=a}return e}function loadVoices(){var e=speechSynthesis.getVoices();if(!e||e.length==0){return}var n=e.filter(function(e){return e.name=="Laura"})[0];if(!n){n=e[0]}gVoice=n;console.log('We will use "%s" voice.',n.name)}function playOrPause(){var e=window.speechSynthesis;if(e.speaking){if(e.paused){e.resume()}else{e.pause()}}}